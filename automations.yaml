- id: ida_knapp_rullgardin_ner
  alias: "Ida knapp - Rullgardin ner"
  description: "Sänker Idas rullgardin till 46% och stänger av smartplug vid close-tryck"
  trigger:
    - platform: mqtt
      topic: zigbee2mqtt/Ida tryckknapp/action
      payload: close
  action:
    - service: cover.set_cover_position
      target:
        entity_id: cover.idas_rullgardin
      data:
        position: 46
    - service: switch.turn_off
      target:
        entity_id: switch.ida_smartplug
  mode: single

- id: ida_knapp_rullgardin_upp
  alias: "Ida knapp - Rullgardin upp"
  description: "Höjer Idas rullgardin till 100% och slår på smartplug vid open-tryck"
  trigger:
    - platform: mqtt
      topic: zigbee2mqtt/Ida tryckknapp/action
      payload: open
  action:
    - service: cover.set_cover_position
      target:
        entity_id: cover.idas_rullgardin
      data:
        position: 100
    - service: switch.turn_on
      target:
        entity_id: switch.ida_smartplug
  mode: single

- id: moa_knapp_rullgardin_ner
  alias: "Moa knapp - Rullgardin ner"
  description: "Sänker Moas rullgardin till 46% och stänger av smartplug vid close-tryck"
  trigger:
    - platform: mqtt
      topic: zigbee2mqtt/Moa tryckknapp/action
      payload: close
  action:
    - service: cover.set_cover_position
      target:
        entity_id: cover.moa_rullgardin
      data:
        position: 46
    - service: switch.turn_off
      target:
        entity_id: switch.moa_smartplug
  mode: single

- id: moa_knapp_rullgardin_upp
  alias: "Moa knapp - Rullgardin upp"
  description: "Höjer Moas rullgardin till 100% och slår på smartplug vid open-tryck"
  trigger:
    - platform: mqtt
      topic: zigbee2mqtt/Moa tryckknapp/action
      payload: open
  action:
    - service: cover.set_cover_position
      target:
        entity_id: cover.moa_rullgardin
      data:
        position: 100
    - service: switch.turn_on
      target:
        entity_id: switch.moa_smartplug
  mode: single

- id: git_pull_on_webhook
  alias: "Git - Pull vid GitHub push"
  description: "Hämtar config från GitHub när webhook triggas av push"
  trigger:
    - platform: webhook
      webhook_id: !secret github_webhook_id
      allowed_methods:
        - POST
      local_only: false
  action:
    - service: shell_command.git_pull
    - delay:
        seconds: 3
    - service: automation.reload
    - service: script.reload
    - service: scene.reload
    - service: persistent_notification.create
      data:
        title: "Git Pull"
        message: "Config uppdaterad från GitHub: {{ now().strftime('%Y-%m-%d %H:%M') }}"
        notification_id: git_pull_status
  mode: single

- id: git_pull_on_startup
  alias: "Git - Pull vid uppstart"
  description: "Hämtar senaste config från GitHub när HA startar"
  trigger:
    - platform: homeassistant
      event: start
  action:
    - delay:
        seconds: 30
    - service: shell_command.git_pull
    - service: persistent_notification.create
      data:
        title: "Uppstart Git Pull"
        message: "Config synkad från GitHub vid uppstart: {{ now().strftime('%Y-%m-%d %H:%M') }}"
        notification_id: git_pull_startup
  mode: single

- id: git_pull_scheduled
  alias: "Git - Schemalagd pull"
  description: "Backup: hämtar config från GitHub var 6:e timme"
  trigger:
    - platform: time_pattern
      hours: "/6"
  action:
    - service: shell_command.git_pull
  mode: single

- id: claude_snapshot_on_demand
  alias: "Claude - Generate Snapshot"
  description: "Generates a live HA snapshot for Claude Desktop when button is pressed"
  trigger:
    - platform: event
      event_type: call_service
      event_data:
        domain: input_button
        service: press
        service_data:
          entity_id: input_button.generate_claude_snapshot
  action:
    - service: script.generate_claude_snapshot
  mode: single
