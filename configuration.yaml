# Loads default set of integrations. Do not remove.
default_config:

# =============================================================================
# HTTP / SSL
# =============================================================================
http:
  ssl_certificate: /ssl/fullchain.pem
  ssl_key: /ssl/privkey.pem
  ip_ban_enabled: true
  login_attempts_threshold: 5

# Load frontend themes from the themes folder
frontend:
  themes: !include_dir_merge_named themes

automation: !include automations.yaml
script: !include scripts.yaml
scene: !include scenes.yaml

# =============================================================================
# SHELL COMMANDS
# =============================================================================
shell_command:
  git_pull: "cd /config && git pull origin master 2>&1"
  git_pull_force: "cd /config && git fetch origin && git reset --hard origin/master 2>&1"
  git_status: "cd /config && git status --short 2>&1"

# =============================================================================
# TEMPLATE SENSORS
# =============================================================================
template:
  - sensor:
      - name: "Elpris SkellefteÃ¥ Kraft"
        unique_id: elpris_skelleftea_kraft
        unit_of_measurement: "SEK/kWh"
        device_class: monetary
        state: >
          {% set spot = states('sensor.nord_pool_se3_current_price') | float(0) %}
          {% set markup = 0.066 %}
          {{ (spot + markup) | round(4) }}
        attributes:
          spot_price: "{{ states('sensor.nord_pool_se3_current_price') }}"
          markup: "0.06 SEK/kWh"
          electricity_certificate: "0.006 SEK/kWh"
          monthly_fee: "39.20 SEK/month"

# =============================================================================
# RECORDER (MariaDB) - Short-term operational data
# =============================================================================
recorder:
  db_url: !secret mysql_url
  purge_keep_days: 10
  commit_interval: 1
  exclude:
    # Domains that don't need history
    domains:
      - automation
      - updater
      - script
      - scene
      - persistent_notification
      - input_button
    # Entity patterns to exclude
    entity_globs:
      - sensor.sun_*
      - sensor.*_uptime*
      - sensor.*_last_boot*
      - sensor.*_last_seen*
      - binary_sensor.*_update*
      - update.*
    # Specific entities
    entities:
      - sun.sun
      - sensor.date
      - sensor.time
      - sensor.date_time
      - sensor.date_time_iso
      - sensor.time_date
      - sensor.time_utc

# =============================================================================
# INFLUXDB - Long-term analytics (Grafana, trends)
# =============================================================================
influxdb:
  host: 192.168.1.62
  port: 8086
  database: homeassistant
  username: homeassistant
  password: !secret influxdb_password
  max_retries: 3
  default_measurement: state
  # Only include specific domains for long-term storage
  include:
    domains:
      - sensor
      - binary_sensor
      - climate
      - weather
      - person
      - device_tracker
  exclude:
    # Exclude noisy/unneeded sensors
    entity_globs:
      - sensor.sun_*
      - sensor.*_uptime*
      - sensor.*_last_boot*
      - sensor.*_last_seen*
      - sensor.*_battery_level # if using battery_notes
      - binary_sensor.*_update*
      - sensor.*_memory*
      - sensor.*_cpu*
      - sensor.*_disk*
    entities:
      - sun.sun
      - sensor.date
      - sensor.time
      - sensor.date_time
      - sensor.date_time_iso
