# =============================================================================
# HOME ASSISTANT CONFIGURATION
# =============================================================================
# Infrastructure:
#   - Home Assistant: 192.168.1.60 (Proxmox VM)
#   - MariaDB: 192.168.1.61:3306 (LXC, 10-day retention)
#   - InfluxDB: 192.168.1.62:8086 (LXC, long-term storage)
#   - MQTT: 192.168.1.63:1883 (Mosquitto, LXC)
#   - Zigbee2MQTT: localhost:8099 (Add-on, ConBee II)
# =============================================================================

# Default Home Assistant setup (frontend, api, etc)
default_config:

# HTTP configuration
http:
  ip_ban_enabled: true
  login_attempts_threshold: 5
  use_x_forwarded_for: true
  trusted_proxies:
    - 192.168.1.70
    - 192.168.1.0/24
    - 172.30.32.0/23 # Supervisor/Add-ons internal network

# Frontend themes
frontend:
  themes: !include_dir_merge_named themes

# =============================================================================
# LOVELACE DASHBOARDS
# =============================================================================
lovelace:
  mode: storage
  dashboards:
    lovelace-electricitet:
      mode: yaml
      title: Electricitet
      icon: mdi:flash
      show_in_sidebar: true
      filename: dashboards/electricitet.yaml

# =============================================================================
# INCLUDED FILES
# =============================================================================
automation: !include automations.yaml
script: !include scripts.yaml
scene: !include scenes.yaml

# =============================================================================
# INPUT HELPERS
# =============================================================================
input_button:
  generate_claude_snapshot:
    name: "Generate Claude Snapshot"
    icon: mdi:robot

# =============================================================================
# SHELL COMMANDS
# =============================================================================
shell_command:
  git_pull: "cd /config && git pull origin master 2>&1"
  git_pull_force: "cd /config && git fetch origin && git reset --hard origin/master 2>&1"
  git_status: "cd /config && git status --short 2>&1"
  git_diff_files: "cd /config && git diff --name-only HEAD~1 HEAD 2>&1"
  generate_claude_snapshot: "python3 /config/scripts/generate_claude_snapshot.py"

# =============================================================================
# INTEGRATIONS
# =============================================================================

# Camera streaming
stream:

# =============================================================================
# LOGGING
# =============================================================================
logger:
  default: warning
  # logs:
  #   custom_components.sector_alarm: info

# =============================================================================
# SENSORS
# =============================================================================
template: !include template_sensors.yaml
sql: !include sql_sensors.yaml

# =============================================================================
# RECORDER (MariaDB) - Short-term operational data
# =============================================================================
recorder:
  db_url: !secret mysql_url
  purge_keep_days: 10
  commit_interval: 1
  exclude:
    # Domains that don't need history
    domains:
      - automation
      - updater
      - script
      - scene
      - persistent_notification
      - input_button
    # Entity patterns to exclude
    entity_globs:
      - sensor.sun_*
      - sensor.*_uptime*
      - sensor.*_last_boot*
      - sensor.*_last_seen*
      - binary_sensor.*_update*
      - update.*
    # Specific entities
    entities:
      - sun.sun
      - sensor.date
      - sensor.time
      - sensor.date_time
      - sensor.date_time_iso
      - sensor.time_date
      - sensor.time_utc

# =============================================================================
# INFLUXDB - Long-term analytics (Grafana, trends)
# =============================================================================
influxdb:
  host: 192.168.1.62
  port: 8086
  database: homeassistant
  username: homeassistant
  password: !secret influxdb_password
  max_retries: 3
  default_measurement: state
  # Only include specific domains for long-term storage
  include:
    domains:
      - sensor
      - binary_sensor
      - climate
      - weather
      - person
      - device_tracker
      - cover
    # Specific entities worth tracking
    entities:
      - switch.ugn_av_pa
      - switch.spishall_av_pa
      - switch.frys
      - switch.ftx
      - switch.casa
  exclude:
    # Exclude noisy/unneeded sensors
    entity_globs:
      - sensor.sun_*
      - sensor.*_uptime*
      - sensor.*_last_boot*
      - sensor.*_last_seen*
      - sensor.*_battery_level # if using battery_notes
      - binary_sensor.*_update*
      - sensor.*_memory*
      - sensor.*_cpu*
      - sensor.*_disk*
    entities:
      - sun.sun
      - sensor.date
      - sensor.time
      - sensor.date_time
      - sensor.date_time_iso
